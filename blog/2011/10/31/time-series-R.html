<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

<head>
 <meta http-equiv="content-type" content="text/html; charset=utf-8" />
 <title>Gráficos de séries temporais no R</title>
 <meta name="author" content="Alexandre Rademaker" />
 <link href="http://feeds.feedburner.com/arademaker" rel="alternate" title="Alexandre Rademaker" type="application/atom+xml" />
 
 <!-- syntax highlighting CSS -->
 <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

 <!-- <link href="/css/highlight.css" rel="stylesheet" type="text/css"> -->
 <link href="/css/gists.css" rel="stylesheet" type="text/css"/>

 <!-- Homepage CSS -->
 <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />

 <!-- Typekit 
 <script type="text/javascript" src="http://use.typekit.com/jpd0pfm.js"></script>
 <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
 -->

 <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>



<!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-97240-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body>
  <div id="outer">

    <div id="top"></div>

    <div id="left">
      <img src="/images/eu-sf.jpg"/>
    </div>  

    <div class="site">
      <div class="title">
	<a href="/">Alexandre Rademaker</a>
	<a class="extra" href="/">home</a>
	<a class="extra" href="/about.html">about me</a>
	<a class="extra" href="/publications/index.html">publications</a>
        <a class="extra" href="/research.html">research</a>
      </div>
      
      <div id="post">
<h1>Gráficos de séries temporais no R</h1>

<p>Pergunta de dois alunos: como postar duas séries temporáis usando o
ggplot? Resolvi responder usando este post. Vou aproveitar então para
mostrar como postar séries temporáis usando o ggplot, lattice e o plot
padrão do R.</p>

<h2>Criando os dados</h2>

<p>Para começar, criei um objeto série temporal conforme exemplo da função <code>ts</code>
do R. Este objeto na realidade é uma matriz, são três séries temporais
ou uma série temporal multivariável.</p>

<pre><code>&gt; dados &lt;- ts(matrix(rnorm(300), 100, 3), start=c(1961, 1), 
              frequency=12)
&gt; dados[1:4,]
       Series 1   Series 2   Series 3
[1,]  1.4165848  2.1049293  1.0155993
[2,] -0.4264193 -0.2730903  0.8754992
[3,]  0.5120809 -0.4023986  1.9757084
[4,]  0.1375277 -0.5043973 -0.7795633
</code></pre>

<h2>Plot básico</h2>

<p>Se usarmos o comando padrão de plot do pacote basic do R, temos o
seguinte plot.</p>

<pre><code>&gt; plot(ts)
</code></pre>

<p><img src="/images/2011-10-31-plot-basic.png" title="plot basic" alt="plot-basic" /></p>

<p>Obviamente, neste e nos próximos exemplos, estou mostrando o uso mais
básico das funções, sem me preocupar com nenhum ajuste de formatação,
legenda, rótulos, cores etc.</p>

<h2>No pacote lattice</h2>

<p>No pacote Lattice, temos a função xyplot que contém vários
parâmetros para geração do gráfico. Explorei apenas a forma de gerar
uma série por painel e todas as séries em um painel.</p>

<pre><code>&gt; xyplot(dados)
</code></pre>

<p><img src="/images/2011-10-31-plot-lattice-1.png" title="plot lattice" alt="plot-lattice-1" /></p>

<pre><code>&gt; xyplot(dados, superpose = TRUE) 
</code></pre>

<p><img src="/images/2011-10-31-plot-lattice-2.png" title="plot lattice" alt="plot-lattice-2" /></p>

<p>A página de help da função <code>xyplot</code> contém muito mais informação sobre
os demais parâmetros da função. A função <code>xyplot</code> também tem um método
específico para lidar com objetos da classe Zoo do pacote
<a href="http://cran.r-project.org/web/packages/zoo/index.html">zoo</a>.</p>

<h2>No pacote ggplot</h2>

<p>Finalmente, como fazer no ggplot? Este foi o mais difícil. Demorei
bastante a encontrar referências via google. As mais relevantes que
encontrei foram:</p>

<ul>
<li><a href="http://had.co.nz/ggplot2/scale_date.html">scale_date</a></li>
<li><a href="http://learnr.wordpress.com/2009/05/05/ggplot2-two-time-series-with-different-dates/">ggplot2: two time series with different dates</a></li>
<li><a href="http://goo.gl/Kr5wP">Using ggplot, how to have the x-axis of time series plots set up automatically?</a></li>
</ul>


<p>O último link é a dica de como transformar um objeto <code>ts</code> em um
data.frame:</p>

<pre><code>datas &lt;- seq(as.Date(paste(c(start(dados),1), collapse="/")), 
             by = "month", length.out = length(dados))
dados.df &lt;- data.frame(date = datas, value = dados)
</code></pre>

<p>E finalmente consegui plotar uma série das três com:</p>

<pre><code>&gt; ggplot(data=dados.df) + geom_line(aes(date, value.Series.1))
</code></pre>

<p><img src="/images/2011-10-31-plot-ggplot-single.png" title="plot ggplot" alt="plot-ggplot" /></p>

<p>Para conseguir em um único gráfico as três séries temporais, tive mais
trabalho. Primeiro em transformar os dados em um data.frame que
pudesse ser entendido pelo ggplot.</p>

<pre><code>&gt; tmp &lt;- stack(dados.df, select = -1)
&gt; tmp$date &lt;- dados.df[,1]
</code></pre>

<p>E finalmente, o novo plot:</p>

<pre><code>&gt; ggplot(data=dados.df) + geom_line(aes(date, value.Series.1))
</code></pre>

<p><img src="/images/2011-10-31-plot-ggplot-multi.png" title="plot ggplot" alt="plot-ggplot-multi" /></p>

<h2>Conclusão</h2>

<p>Não existe pacote melhor ou pior, cada um é mais adequado para cada
situação. No particular problema de plotar multiplas séries temporais,
sem nenhuma dúvida, preferi a facilidade do lattice em lidar com
objetos <code>ts</code>.</p>

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>06 May 2012</span> &raquo; <a href="/blog/2012/05/06/problema-dos-galoes.html">O problema dos galões</a></li>
    
      <li><span>15 Feb 2012</span> &raquo; <a href="/blog/2012/02/15/lattes-to-bibtex.html">Lattes to BibTeX</a></li>
    
      <li><span>02 Jan 2012</span> &raquo; <a href="/blog/2012/01/02/package-SSOAP.html">R Package SSOAP</a></li>
    
  </ul>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'arademaker'; 

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




      <div class="footer">
	<div class="contact">
	  <p>
            Alexandre Rademaker<br />
            Professor at <a href="http://emap.fgv.br/">EMAp/FGV</a><br />
            arademaker AT gmail DOT com
	  </p>
	</div>
	<div class="contact">
	  <p>
        <a href="http://github.com/arademaker/">github.com/arademaker</a><br />
        <a href="http://twitter.com/arademaker/">twitter.com/arademaker</a><br />
        <a href="http://facebook.com/alexandre.rademaker">Facebook</a>
	  </p>
	</div>
	<div class="rss">
	  <a href="http://feeds.feedburner.com/arademaker">
            <img src="/images/rss.png" alt="Subscribe to RSS Feed" />
	  </a>
	</div>
      </div>
    </div>

    <div id="right">
    </div>
  </div>
</body>
</html>

